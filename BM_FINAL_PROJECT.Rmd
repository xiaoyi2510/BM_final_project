---
title: "Bm_final_project"
author: "Yi Xiao"
date: "10/12/2018"
output: html_document
---
```{r}
library(tidyverse)
library(kableExtra)
library(Hmisc)
library(leaps)
```

1. load the dataset
```{r}
cancer_data <- read_csv("./data/Cancer_Registry.csv") %>%
        janitor::clean_names()
```
The Cancer Registry Dataset cantains information on cancer mortality rate across `r n_distinct(cancer_data$geography)` US counties. There are `r ncol(cancer_data)` variables which provide information on death rate and related demographical characteristics in each county. The outcome variable in this datset is `target_death rate` (continuous). 

2. explore the data

```{r}
# 1. deal with missing data

num_var <- cancer_data %>%
        select(-c(binned_inc, geography))
# summary table for all numberical variables:
num_var %>%
        skimr::skim_to_wide() %>% knitr::kable() %>% kable_styling(full_width = F, position = "left")

cancer_data %>%
   select(geography,binned_inc) %>%
describe()

# presence of large amount of missing data (over 20%)  in two variabls: pct_some_col18_24 and pct_private_coverage_alone
# remove those two variables 

```
 
 
```{r}
# 2. check normality
ggplot(gather(num_var), aes(value)) + 
    geom_histogram(bins = 10) + 
    facet_wrap(~key, scales = 'free_x')
```
 
heavyly-left-skewed: avg_ann_count, avg_deaths_per_year, med_income, pop_est2015, median_age, pct_asian, pct_black, pct_other_race, study_per_cap: we could categorise those continuous variables
right-skewed: pct_white
outcome variable has a roughly normal disribution.

```{r}
# check colinearity
colin = cor(num_var) 

```

avg_ann_count: avg_deaths_per_year, pop_est2015
avg_deaths_per_year: pop_est2015
med_income: poverty_pct, pct_bach_deg25_over, pct_private_coverage, pct_private_coverage_alone, pct_emp_priv_coverage, pct_public_coverage, pct_public_coverage_alone
poverty_percent: pct_private_coverage, pct_public_coverage_alone
pct_unemployed16_over: avg_death_per_year


some comments:
1. med_income and poverty_percent: high colinearity & basically the same thing: consider removing one of them
2.avg-ann-count and population / avg_death and population: duplicate information with "incidence" and the outcome variable: remove?



3. tidy
```{r}
tidy_data = cancer_data %>% 
  select(-pct_some_col18_24, -pct_private_coverage_alone, -poverty_percent, -median_age_female, -median_age_male, -avg_ann_count, -avg_deaths_per_year, -pct_public_coverage, -pct_hs25_over, -pct_employed16_over, -pct_married_households, -pct_emp_priv_coverage, -binned_inc, -pct_hs18_24, -pct_no_hs18_24, -pct_bach_deg18_24) %>% 
  separate(geography, into = c("county", "state"), sep = ", ") %>% 
   mutate(region = case_when(  
            state %in% c("Montana", "Arizona","Idaho","Colorado", "New Mexico","Utah","Nevada","Wyoming","Alaska","California",
            "Hawaii","Oregon","Washington") ~ "West",
            state %in% c("Illinois","Indiana", "Michigan","Iowa","Ohio", "Kansas","Minnesota","Missouri","Wisconsin", "Nebraska","North Dakota","South Dakota") ~ "Midwest",
            state %in% c("District of Columbia", "Delaware","Georgia",
            "Maryland", "North Carolina","Florida","South Carolina",
            "West Virginia","Kentucky", "Alabama","Virginia","Mississippi", "Arkansas","Tennessee","Louisiana","Oklahoma","Texas") ~ "South",
             state %in%  c("Connecticut","Maine","Massachusetts","New Hampshire",
             "Rhode Island","Vermont","New Jersey","New York",
             "Pennsylvania") ~ "Northeast" ), region = as.factor(region) %>% fct_relevel(., "West", "Midwest", "Northeast", "South"))

tidy_data = tidy_data %>%
  select(-county, -state) %>% 
  mutate(pct_non_black = pct_asian + pct_white + pct_other_race) %>% 
  select(-pct_asian, -pct_white, -pct_other_race)
        
 
        
    
        
```


4. criterion 


```{r}
all_fit = lm(target_death_rate ~., data = tidy_data)
summary(all_fit)
```


stepwise regression
```{r}
step(all_fit, direction='backward') # AIC criteria
```

```{r}
# Cp criterion:
tidy_data2 = data.matrix(tidy_data)
leaps(x = tidy_data2[,-1], y = tidy_data2[, 1], nbest = 2, method = "Cp")
# adjusted R^2 criterion:
leaps(x = tidy_data2[ , -1], y = tidy_data2[, 1], nbest = 2, method = "adjr2")


best_summary = summary(regsubsets(target_death_rate ~ ., data = tidy_data)) 

# plot
 tibble(x = 1:8, y = best_summary$cp) %>%
 ggplot(aes(x = x, y = y)) +
    geom_point() +
    labs(x = "NO of predictors", y = "Cp")
 
  tibble(x = 1:8, y = best_summary$adjr2) %>%
 ggplot(aes(x = x, y = y)) +
    geom_point() +
    labs(x = "NO of predictors", y = "Adjusted-R-squared")
```

Reference:
1. geographocal distribution of cancer mortality
https://www.cancer.gov/news-events/cancer-currents-blog/2017/cancer-death-disparities

2. social disparity:
https://www.ncbi.nlm.nih.gov/pubmed/28718431

3. socialeconomic factor
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2711979/
