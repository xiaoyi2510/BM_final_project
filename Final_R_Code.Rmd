---
title: "Modeling Variation of Cancer Mortality Rate in the United States"
author: "Group 1: Samantha Brown, Ruiyang Li, Jiyue Qin, Yi Xiao"
date: "12/16/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Code for Final Project

#1. load the dataset
```{r}
cancer_data <- read_csv("./data/Cancer_Registry.csv") %>%
        janitor::clean_names()
```
The Cancer Registry Dataset cantains information on cancer mortality rate across `r n_distinct(cancer_data$geography)` US counties. There are `r ncol(cancer_data)` variables which provide information on death rate and related demographical characteristics in each county. The outcome variable in this datset is `target_death rate` (continuous). 

#2. explore the data
## 2.1 summary of the variables 
```{r}
num_var <- cancer_data %>%
       dplyr::select(-c(binned_inc, geography))
# summary table for all numberical variables:
num_var %>%
        skimr::skim_to_wide() %>% knitr::kable() %>% kable_styling(full_width = F, position = "left")

## summary for two categorical variables
cancer_data %>%
   dplyr::select(geography,binned_inc) %>%
describe()
```

## 2.2 dealing with missing data
```{r}

cancer_data %>%
  summarise_all(funs(sum(is.na(.)))) %>% 
  gather(term, na_num, avg_ann_count:birth_rate) %>% 
  filter(na_num > 0) %>% 
  arrange(desc(na_num)) %>%
  mutate(percent = round(na_num/sum(na_num), 2)) %>%
        kable(col.names = c("variable name",
                           "number of missing value",
                           "percent"
                           )) %>%
        kable_styling(position = "left")
```
 We observed presence of large amount of missing data (over 20%) in two variabls: pct_some_col18_24 and pct_private_coverage_alone.
 
 
## 2.3 check normality 
```{r}


# histogram of all variables 
num_tidy = cancer_data %>%
        select(-c(geography, binned_inc))

ggplot(gather(num_tidy), aes(value)) + 
    geom_histogram(bins = 10) + 
    facet_wrap(~key, scales = 'free_x')

# plot the histogram of the outcome: target death rate
cancer_data %>% 
  ggplot(aes(x = target_death_rate)) + 
    geom_histogram(aes(y = ..density..),  
                   binwidth = 5, colour = "black", fill = "white") +
    geom_density(alpha = .2, fill = "lightblue") +
    geom_vline(aes(xintercept = mean(target_death_rate, na.rm = T)),   
               color = "blue", linetype = "dashed", size = 1) +
        labs(x = "Average cancer mortalities per capita from 2010 to 2016",
             y = "Distribution") +
        theme_bw() +
        theme(axis.text=element_text(size=20))

```
 
Outcome variable target death rate has a normal distribution, which suggests linear regression could be an appropriate approach. Heavyly-left-skewed variables include avg_ann_count, avg_deaths_per_year, med_income, pop_est2015, median_age, pct_asian, pct_black, pct_other_race, study_per_cap. Right-skewed variable includes pct_white. We could consider categorising those continuous variables

## 2.4 check linear relationship
```{r}
## ralationship between cancer mortality rate and median age - unrealistic value observed!
cancer_data %>%
  select(target_death_rate, median_age) %>% 
  ggplot(aes(x = median_age, y = target_death_rate)) +                    
    geom_point(na.rm = TRUE) +
    geom_smooth(se = FALSE, method = "lm") +
        labs(x = "median age", 
             y = "Average cancer mortalities per capita from 2010 to 2016") +
        theme_bw() +
        theme(axis.text=element_text(size=20))

## remove such values and check the relationship again
tidy_data %>%
  select(target_death_rate, median_age) %>% 
  ggplot(aes(x = median_age, y = target_death_rate)) +                    
    geom_point(na.rm = TRUE) +
    geom_smooth(se = FALSE, method = "lm")  +
        labs(x = "median age", 
             y = "Average cancer mortalities per capita from 2010 to 2016") +
        theme_bw() +
        theme(axis.text=element_text(size=20))

## relationship between cancer mortality rate and 
num_var %>%
        select(-median_age) %>%
  select(target_death_rate, avg_ann_count:birth_rate) %>% 
  gather(key = key, value, avg_ann_count:birth_rate) %>%   
  ggplot(aes(x = value, y = target_death_rate)) +                    
    facet_wrap(~ key, scales = "free") +  
    geom_point(na.rm = TRUE) +
  geom_smooth(se = FALSE, method = "lm") 


```
Several unreasonable values can be observed in median age variable. 


## 2.5 check collinearity 

